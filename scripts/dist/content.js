!function(){var e=this&&this.__awaiter||function(e,t,n,o){return new(n||(n=Promise))((function(r,c){function i(e){try{a(o.next(e))}catch(t){c(t)}}function s(e){try{a(o.throw(e))}catch(t){c(t)}}function a(e){var t;e.done?r(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(i,s)}a((o=o.apply(e,t||[])).next())}))};Object.defineProperty({},"__esModule",{value:!0});const t=window.wrappedJSObject;function n(){const e={protocolVersion:3},t=window.mqtt;WebSocket=new Proxy(WebSocket,{construct(n,o,r){const c=Reflect.construct(n,o,r);return c.addEventListener("message",n=>{const o=t.parser(e);o.on("packet",e=>{e.cmd}),o.on("error",e=>{}),o.parse(n.data)}),c.send=new Proxy(c.send,{apply(n,o,r){const c=window.cfg,i=r[0],s=t.parser(e);s.on("packet",i=>{if("publish"==i.cmd&&"/ls_req"==i.topic){const s=(new TextDecoder).decode(i.payload),a=JSON.parse(s);if(c.blockTyping&&4==a.type){const e=JSON.parse(a.payload),t=JSON.parse(e.payload);if(!t.thread_key)return Reflect.apply(n,o,r);let i=!1;if("blacklist"==c.blockMode?c.blacklist.includes(t.thread_key.toString())&&(i=!0):c.whitelist.includes(t.thread_key.toString())||(i=!0),i)return}if(c.blockSeen&&3==a.type){const s=JSON.parse(a.payload);let l=null;for(const e in s.tasks)if("21"==s.tasks[e].label){const t=JSON.parse(s.tasks[e].payload);l=t.thread_id.toString(),t.last_read_watermark_ts=1e3*Date.now(),s.tasks[e].payload=JSON.stringify(t)}if(l){let d=!1;if("blacklist"==c.blockMode?c.blacklist.includes(l)&&(d=!0):c.whitelist.includes(l)||(d=!0),d)return a.payload=JSON.stringify(s),i.payload=JSON.stringify(a),r[0]=t.generate(i,e),Reflect.apply(n,o,r)}}}return Reflect.apply(n,o,r)}),s.on("error",e=>Reflect.apply(n,o,r)),s.parse(i)}}),c}})}browser.runtime.onMessage.addListener((n,o)=>e(void 0,void 0,void 0,(function*(){try{const e=JSON.parse(n);e.cfg&&(t.cfg=cloneInto(e.cfg,window))}catch(e){console.log("msg",e)}}))),browser.runtime.connect(),t.browser=cloneInto(browser,window,{cloneFunctions:!0}),document.addEventListener("DOMContentLoaded",(function(){var e;null===(e=document.getElementById("inject-mqtt"))||void 0===e||e.remove();const t=document.createElement("script");t.id="inject-mqtt",t.src=browser.runtime.getURL("scripts/dist/mqtt.js"),t.onload=()=>{var e,t,o;null===(e=document.getElementById("inject-script"))||void 0===e||e.remove();const r=document.createElement("script");r.id="inject-script",r.textContent=`!(()=>{${n.toString()};${n.name}();})()`,document.head.insertBefore(r,null!==(o=null===(t=document.head.firstChild)||void 0===t?void 0:t.nextSibling)&&void 0!==o?o:null)},document.head.insertBefore(t,document.head.firstChild)}))}();